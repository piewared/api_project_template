# TYPE  DATABASE        USER            ADDRESS                 METHOD

# Unix socket: allow postgres via peer, others via SCRAM
local   all             postgres                                peer
local   all             all                                     scram-sha-256

# Localhost (IPv4/IPv6)
host    all             all             127.0.0.1/32            scram-sha-256
host    all             all             ::1/128                 scram-sha-256

# Replication from localhost only (adjust or restrict to a replication role)
local   replication     all                                     peer
host    replication     all             127.0.0.1/32            scram-sha-256
host    replication     all             ::1/128                 scram-sha-256

# --- Enforce TLS on networks you actually use ---

# 1) Explicitly reject NON-TLS first (v4 + v6)
hostnossl all           all             0.0.0.0/0               reject
hostnossl all           all             ::/0                    reject

# 2) Allow TLS from your Docker/LAN subnets only
hostssl  all            all             172.30.50.0/24          scram-sha-256   # your backend network
hostssl  all            all             172.18.0.0/16           scram-sha-256   # if you actually use this
hostssl  all            all             10.10.0.0/16            scram-sha-256   # if you actually use this
hostssl  all            all             10.244.0.0/16           scram-sha-256   # Kubernetes pod network

# 3) Final catch-alls (defense in depth; come LAST)
host     all            all             0.0.0.0/0               reject
host     all            all             ::/0                    reject
